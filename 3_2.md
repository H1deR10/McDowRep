```mermaid
stateDiagram-v2
    [*] --> Новый

    Новый --> Подтвержденный : заказ принят
    Подтвержденный --> Оплата : клиент переходит к оплате

    state Оплата {
        [*] --> Ожидание_оплаты
        Ожидание_оплаты --> Обработка_платежа : платёж начат
        Обработка_платежа --> Оплаченный : платёж успешен
        Обработка_платежа --> Ошибка_оплаты : ошибка
        Ошибка_оплаты --> Ожидание_оплаты : повторить попытку
    }

    Оплата --> Отправленный : оплата подтверждена
    Отправленный --> Доставленный : заказ доставлен

    Новый --> Отмененный : клиент отменил заказ
    Подтвержденный --> Отмененный : отмена до оплаты
    Оплата --> Отмененный : платёж не завершён
    Доставленный --> Возвращенный : возврат товара

    Доставленный --> [*]
    Отмененный --> [*]
    Возвращенный --> [*]
